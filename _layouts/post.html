<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <title>{{ page.title }} – {{ site.title }}</title>

    <!-- Basic meta -->
    <meta name="description" content="{{ page.summary | default: page.excerpt | strip_html | truncate: 160 }}">
    <meta name="author" content="{{ page.author | default: site.author }}">

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <noscript><link rel="stylesheet" href="{{ '/assets/css/noscript.css' | relative_url }}"></noscript>

    <style>
      .post-meta{opacity:.75;margin:.25rem 0 1rem}
      .post-tags{display:flex;flex-wrap:wrap;gap:.4rem;margin:0 0 1.25rem}
      .post-tags a{font-size:.8rem;padding:.25rem .55rem;border:1px solid #ddd;border-radius:999px;text-decoration:none}
      .post-tags a:hover{border-color:#aaa}
      .post-nav{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem}
      .post-nav a{white-space:nowrap}

      /* nav search icon visibility on dark header */
      #nav .nav-icon { background:none;border:0;padding:.25rem;cursor:pointer;color:inherit;display:flex;align-items:center; }
      #nav .nav-icon svg { color:#fff; stroke:#fff; opacity:.9; }
      #nav .nav-icon:hover svg { opacity:1; }

      /* results hover (also mirrored in assets/css/main.css if you want) */
      #results-container a.sr{transition:color .2s}
      #results-container a.sr:hover{color:#3aa3ff;text-decoration:underline}
    </style>
  </head>
  <body class="is-preload">
    <div id="wrapper">

      <!-- Header -->
      <header id="header">
        <a href="{{ '/' | relative_url }}" class="logo">{{ site.title }}</a>
      </header>

      <!-- Nav -->
      <nav id="nav" style="display:flex;align-items:center;justify-content:space-between;">
        <ul class="links" style="margin:0;display:flex;align-items:center;gap:2rem;">
          <li class="active"><a href="/">Field Notes & Research</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="/science/">Science In Action</a></li>
        </ul>

        <!-- Right: Tags + Search -->
        <div style="display:flex;align-items:center;gap:1rem;">
          <a href="{{ '/tags/' | relative_url }}" style="text-decoration:none;">Tags</a>

          <!-- Click fallback via onclick + type=button -->
          <button id="open-search" type="button" aria-label="Open search"
                  class="nav-icon" onclick="window.__openSearch && window.__openSearch()">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
        </div>
      </nav>

      <!-- Main -->
      <div id="main">
        <section class="post">
          <header class="major">
            <span class="date">{{ page.date | date: "%b %-d, %Y" }}</span>
            <h1>{{ page.title }}</h1>
            {% if page.subtitle %}<p>{{ page.subtitle }}</p>{% endif %}

            {% if page.author %}
              <p class="post-meta">By {{ page.author }}</p>
            {% endif %}

            {% if page.tags %}
              <div class="post-tags">
                {% for t in page.tags %}
                  <a href="{{ '/tag/' | append: t | slugify | append: '/' | relative_url }}">#{{ t }}</a>
                {% endfor %}
              </div>
            {% endif %}
          </header>

          {% if page.image %}
            <span class="image main"><img src="{{ page.image | relative_url }}" alt=""></span>
          {% endif %}

          {{ content }}

          <div class="post-nav">
            <div>{% if page.previous %}← <a href="{{ page.previous.url | relative_url }}">{{ page.previous.title }}</a>{% endif %}</div>
            <div>{% if page.next %}<a href="{{ page.next.url | relative_url }}">{{ page.next.title }}</a> →{% endif %}</div>
          </div>
        </section>
      </div>

      <!-- Footer -->
      <footer id="footer" style="text-align:center; padding:2rem 0;">
        <a class="button" href="{{ '/' | relative_url }}">← Back to Home</a>
      </footer>
    </div>

    <!-- ===== FULL-SCREEN SEARCH OVERLAY ===== -->
    <div id="search-overlay" aria-hidden="true" role="dialog" aria-label="Search"
         style="position:fixed;inset:0;display:none;z-index:9999;background:rgba(10,12,16,.92)">
      <div style="max-width:980px;margin:12vh auto 0;padding:0 1.25rem;color:#111">
        <div style="display:flex;align-items:center;gap:1rem;justify-content:space-between">
          <h2 style="color:#fff;margin:0;font-size:clamp(1.25rem,2vw,1.6rem);opacity:.9">
            Searching my lab notebook
          </h2>
          <button id="close-search" type="button" aria-label="Close search"
                  style="background:none;border:0;color:#fff;font-size:28px;cursor:pointer;opacity:.85">×</button>
        </div>

        <div style="margin-top:1rem">
          <input id="search-input" type="text"
            placeholder="Type to search posts, tags, and content…"
            style="width:100%;background:transparent;border:0;border-bottom:2px solid rgba(255,255,255,.25);
                   padding:.9rem 0;color:#fff;font-size:clamp(22px,3vw,28px);outline:none" />
        </div>

        <ul id="results-container" style="list-style:none;margin:1.5rem 0 0;padding:0;color:#e9eef5"></ul>
      </div>
    </div>

    <!-- Theme scripts -->
    <script src="{{ '/assets/js/jquery.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/jquery.scrollex.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/jquery.scrolly.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/browser.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/breakpoints.min.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/util.js' | relative_url }}"></script>
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>

   <!-- Simple-Jekyll-Search + overlay logic -->
<script src="https://unpkg.com/simple-jekyll-search/dest/simple-jekyll-search.min.js"></script>
<script>
(function () {
  const overlay = document.getElementById('search-overlay');
  const openBtn = document.getElementById('open-search');
  const closeBtn = document.getElementById('close-search');
  const input = document.getElementById('search-input');
  const results = document.getElementById('results-container');

  function openSearch() {
    overlay.style.display = 'block';
    overlay.setAttribute('aria-hidden','false');
    setTimeout(() => input && input.focus(), 50);
  }
  function closeSearch() {
    overlay.style.display = 'none';
    overlay.setAttribute('aria-hidden','true');
    input.value = '';
    results.innerHTML = '';
  }

  // Fallback for inline onclick
  window.__openSearch = openSearch;

  // Listeners
  openBtn && openBtn.addEventListener('click', openSearch);
  closeBtn && closeBtn.addEventListener('click', closeSearch);
  overlay && overlay.addEventListener('click', (e) => { if (e.target === overlay) closeSearch(); });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeSearch();
    if (e.key === '/' && !e.metaKey && !e.ctrlKey) { e.preventDefault(); openSearch(); }
  });

  // Search
  SimpleJekyllSearch({
    searchInput: input,
    resultsContainer: results,
    json: '{{ "/search.json?v=" | append: site.time | date: "%s" | relative_url }}', // cache-bust
    searchableFields: ['title', 'tags', 'content'],
    searchResultTemplate:
      '<li class="sr-item">' +
        '<a class="sr" href="{url}">{title}</a>' +
        ' <span class="sr-date">— {date}</span>' +
        '<div class="sr-tags">{tags}</div>' +
      '</li>',
    noResultsText: '<li class="sr-none">No results.</li>',
    limit: 50,
    fuzzy: true
  });
})();
</script>
</body>
</html>
